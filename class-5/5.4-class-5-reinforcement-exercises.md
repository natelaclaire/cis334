---
layout: default
title: 5.4 Class 5 Reinforcement Exercises
nav_order: 4
---

# 5.4 Class 5 Reinforcement Exercises

## Exercise 5-1: Import MLB Team Batting Stats into MySQL

### Goal

Define a `teamstats` table in your `mydb` database, and load records from `team_stats.txt`.

#### 1) Connect to MySQL

Open your Terminal tab in your Codespace and connect to the `db` host using the `mariadb` username and password:

```bash
mysql -hdb -umydb -p
```

Enter your password when prompted.

---

#### 2) Select the database

```sql
USE mydb;

-- Verify you're in the right database
SELECT DATABASE();
```

You should see `mydb`.

---

#### 3) Create the `teamstats` table

We’ll use `DECIMAL` for averages/ERA, and a composite primary key on (`Team`, `FirstYear`).

```sql
DROP TABLE IF EXISTS teamstats;

CREATE TABLE teamstats (
  Team       VARCHAR(100)  NOT NULL,
  FirstYear  INT           NOT NULL,
  G          INT           NOT NULL,  -- Games
  W          INT           NOT NULL,  -- Wins
  L          INT           NOT NULL,  -- Losses
  Pennants   INT           NOT NULL,  -- League pennants
  WS         INT           NOT NULL,  -- World Series titles
  R          INT           NOT NULL,  -- Runs
  AB         INT           NOT NULL,  -- At-bats
  H          INT           NOT NULL,  -- Hits
  HR         INT           NOT NULL,  -- Home runs
  AVG        DECIMAL(5,3)  NOT NULL,  -- Batting average (e.g., 0.265)
  RA         INT           NOT NULL,  -- Runs allowed
  ERA        DECIMAL(4,2)  NOT NULL,  -- Earned Run Average (e.g., 3.74)
  PRIMARY KEY (Team, FirstYear)
) ENGINE=InnoDB;
```

Check the structure:

```sql
DESCRIBE teamstats;
```

---

#### 4) Load the data from `team_stats.txt`

The following command demonstrates specifying the field and line terminators and also the order of the fields.

```sql
LOAD DATA INFILE
  '/etc/sql-backup/chapter-7/team_stats.txt'
INTO TABLE teamstats
FIELDS TERMINATED BY '\t'
LINES TERMINATED BY '\n'
(Team, FirstYear, G, W, L, Pennants, WS, R, AB, H, HR, AVG, RA, ERA);
```

---

#### 5) Verify the import

Basic checks:

```sql
-- How many rows?
SELECT COUNT(*) AS rows_loaded FROM teamstats;

-- Peek at a few rows
SELECT * FROM teamstats LIMIT 10;

-- Sanity checks
SELECT MIN(AVG) AS min_avg, MAX(AVG) AS max_avg FROM teamstats;
SELECT MIN(ERA) AS min_era, MAX(ERA) AS max_era FROM teamstats;
```

Averages should look like `0.xxx` and ERA typically ranges from about `1.00` to `7.00+` depending on era/teams.

---

#### 6) Run some stats

Run the following SQL statements, copy the output, and include it in your assignment submission:

```sql
-- Top 10 teams by AVG
SELECT Team, FirstYear, AVG
FROM teamstats
ORDER BY AVG DESC
LIMIT 10;

-- Most home runs
SELECT Team, FirstYear, HR
FROM teamstats
ORDER BY HR DESC
LIMIT 10;

-- Win percentage by team-season
SELECT Team, FirstYear, W, L, ROUND(W / NULLIF(W + L, 0), 3) AS WinPct
FROM teamstats
ORDER BY WinPct DESC
LIMIT 10;
```



## Exercise 5-2: Query MLB Team Stats with MySQL

### Goal

Practice core `SELECT`, `ORDER BY`, `LIMIT`, and aggregate functions over the `teamstats` table in the `mydb` database. Include the responses from all SQL statements in the assignment submission.

---

### 1) Connect and select the database (quick check)

```sql
-- Connect with your MySQL client, then:
USE mydb;
SELECT DATABASE();
```

---

### 2) Return team names, games played, and at-bats

```sql
-- 2a) Basic projection
SELECT Team, G, AB
FROM teamstats;

-- 2b) Sorted by team name (A → Z)
SELECT Team, G, AB
FROM teamstats
ORDER BY Team;

-- 2c) Reverse sorted by team name (Z → A)
SELECT Team, G, AB
FROM teamstats
ORDER BY Team DESC;
```

---

### 3) Teams with the least and most all-time home runs

#### Simple approach (uses `LIMIT 1`)

```sql
-- Least HR
SELECT Team, HR
FROM teamstats
WHERE HR IS NOT NULL
ORDER BY HR ASC, Team ASC
LIMIT 1;

-- Most HR
SELECT Team, HR
FROM teamstats
WHERE HR IS NOT NULL
ORDER BY HR DESC, Team ASC
LIMIT 1;
```

#### Ties-aware approaches (recommended)

If multiple teams share the min/max HR, the above returns just one row. Use either `MIN/MAX` filtering or a window function to return **all** tied teams.

**A) MIN/MAX filter**

```sql
-- All teams with the minimum HR
SELECT Team, HR
FROM teamstats
WHERE HR = (SELECT MIN(HR) FROM teamstats);

-- All teams with the maximum HR
SELECT Team, HR
FROM teamstats
WHERE HR = (SELECT MAX(HR) FROM teamstats);
```

**B) Window function with `DENSE_RANK()`** (MySQL 8+)

```sql
-- All teams with the least HR
WITH ranked AS (
  SELECT Team, HR,
         DENSE_RANK() OVER (ORDER BY HR ASC) AS rnk
  FROM teamstats
  WHERE HR IS NOT NULL
)
SELECT Team, HR
FROM ranked
WHERE rnk = 1;

-- All teams with the most HR
WITH ranked AS (
  SELECT Team, HR,
         DENSE_RANK() OVER (ORDER BY HR DESC) AS rnk
  FROM teamstats
  WHERE HR IS NOT NULL
)
SELECT Team, HR
FROM ranked
WHERE rnk = 1;
```

> Note: `LIMIT` returns *some* min/max row; `MIN/MAX` (or window functions) returns *all* tied rows—often what you want in analytics.

---

### 4) Aggregates: total games and batting averages

#### 4a) Total number of games played

Each game is counted twice in `G` (once per team). Divide by 2:

```sql
-- Exact numeric type and an alias
SELECT SUM(G) / 2 AS TotalGames
FROM teamstats;
```

> Note: Always alias computed/aggregate columns (e.g., `AS TotalGames`) so result sets are self-describing.

Optional formatting:

```sql
-- Rounded to 0 decimals
SELECT ROUND(SUM(G) / 2, 0) AS TotalGamesRounded
FROM teamstats;

-- With thousands separators
SELECT FORMAT(SUM(G) / 2, 0) AS TotalGamesFormatted
FROM teamstats;
```

#### 4b) “Naïve” average of team AVG values

This treats each team-season equally (not recommended for true league average, but useful to illustrate `AVG()`):

```sql
SELECT AVG(AVG) AS MeanOfTeamAverages
FROM teamstats;
```

#### 4c) **Weighted** batting average (recommended)

Weight each team’s AVG by its number of at-bats:

```sql
SELECT SUM(AVG * AB) / NULLIF(SUM(AB), 0) AS WeightedAVG
FROM teamstats;
```

Optional rounding:

```sql
SELECT ROUND(SUM(AVG * AB) / NULLIF(SUM(AB), 0), 3) AS WeightedAVG_3dp
FROM teamstats;
```

> Note: `NULLIF(SUM(AB), 0)` prevents division by zero; returns `NULL` if the denominator is 0.

---

#### 5) LIMIT with pagination (optional)

Demonstrate `LIMIT` with `OFFSET` for paging:

```sql
-- First 10 rows alphabetically
SELECT Team, G, AB
FROM teamstats
ORDER BY Team
LIMIT 10 OFFSET 0;

-- Next 10 rows
SELECT Team, G, AB
FROM teamstats
ORDER BY Team
LIMIT 10 OFFSET 10;
```

---

### Quick “Gotchas” & Tips

* Add `WHERE HR IS NOT NULL` when ordering by HR if your dataset might contain NULLs.
* Use `ROUND()` (numeric) vs. `FORMAT()` (localized string) depending on whether you need numbers or display strings.
* Prefer ties-aware patterns (`MIN/MAX` or `DENSE_RANK`) when reporting “least/most.”

---

### Stretch Challenges (Optional)

1. Show the **top 5** teams by HR with ties included (use window functions or a `WHERE HR >=` subquery threshold).
2. Compute **win percentage** per team (`W / (W + L)`) and list the top 10; guard against division by zero.
3. Return each team’s **OPS proxy** using only available columns (e.g., `H`, `AB`, `R`, `HR`) and discuss why it’s only a proxy.

## Exercise 5-3: Create a Home Run Leaders Table in MySQL

### Goal

Create a table `hrleaders` in the `mydb` database containing the top home-run teams from `teamstats`.

---

### 1) Connect and select the database

```sql
USE mydb;
SELECT DATABASE();
```

---

### 2) Create the `hrleaders` table (schema first)

```sql
DROP TABLE IF EXISTS hrleaders;

CREATE TABLE hrleaders (
  Team VARCHAR(100) NOT NULL,
  HR   INT          NOT NULL,
  PRIMARY KEY (Team)
) ENGINE=InnoDB;
```

### 3) Populate with the top 10 HR teams

We can combined `INSERT INTO` WITH `SELECT` to do some powerful stuff, like copying some records from one table into another or generating statistics on one table and storing them in a different table.

Basic “top 10” (breaks ties arbitrarily at #10):

```sql
INSERT INTO hrleaders (Team, HR)
SELECT Team, HR
FROM teamstats
WHERE HR IS NOT NULL
ORDER BY HR DESC, Team ASC
LIMIT 10;
```

### 4) Verify

```sql
SELECT COUNT(*) AS rows_loaded FROM hrleaders;
SELECT * FROM hrleaders ORDER BY HR DESC, Team ASC;
SHOW TABLES;
```

> Note: It's also possible to use the filesystem to accomplish this, as described in the book's Reinforcement Exercise 7-3, but this approach avoids `FILE`/`LOCAL INFILE` issues.


## Exercise 5-4: Create and Populate Chess Tables

### Goal

Create tables that we'll use in a few weeks to keep track of players in our chess game.

---

### 1) Download `chess-schema.sql` and `chess-data.sql`

Right-click the `chess-schema.sql` and `chess-data.sql` files under `sql/chapter-7` in the VS Code Explorer and choose `Download` to save them to your own computer.

### 2) Log Into phpMyAdmin

Click the Ports tab and click Open In Browser for port 8181. Once it loads, enter the `mariadb` username and password and log in.

### 3) Select The Database

Choose the `mydb` database in the sidebar.

### 4) Import The Schema And Data

Click Import, then Choose File and select the `chess-schema.sql` file that you downloaded. Keep the default options and click Import.

Assuming the process is successful, use the same process to load `chess-data.sql`.

### 5) Explore The Database

Your `mydb` database will now be broken into 3 sections: Tables, Views, and Procedures. Spend a little time exploring the new chess-related views and tables.

## Exercise 5-5: Demographics

Create a table named `demographics` that contains fields for the following data (choose your own field names and appropriate data types): country name, primary language, and population. Enter records for at least 10 countries. You can find demographic information for various countries in many places on the Internet, including [Wikipedia](http://www.wikipedia.org/). Write queries that return the following:

* A list of all records sorted by country name
* The country with the highest population
* The country with the lowest population
* Countries that share a common language, such as French
